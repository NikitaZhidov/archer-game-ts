(()=>{"use strict";var t,e,i,s={};s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),function(t){t.UP="UP",t.RIGHT="RIGHT",t.DOWN="DOWN",t.LEFT="LEFT"}(t||(t={})),function(t){t.Stand="stand",t.Run="run",t.Shoot="shoot",t.Die="die"}(e||(e={}));class n{static load(t){const e=new Image;return e.src=t,new Promise(((t,i)=>{e.onload=()=>t(e),e.onerror=()=>i()}))}}class o{static getRandomInt(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}static randomSort(){return Date.now()%100-100*Math.random()}static getRandomBoolean(t){return Math.random()<=t}static getRandomDirection(){switch(this.getRandomInt(0,4)){case 0:return t.UP;case 1:return t.RIGHT;case 2:return t.DOWN;default:return t.LEFT}}static getSpeedByDirection(e,i){switch(e){case t.UP:return{dy:-i,dx:0};case t.DOWN:return{dy:i,dx:0};case t.RIGHT:return{dy:0,dx:i};case t.LEFT:return{dy:0,dx:-i}}}static getOppositeDirection(e){switch(e){case t.UP:return t.DOWN;case t.DOWN:return t.UP;case t.RIGHT:return t.LEFT;case t.LEFT:return t.RIGHT}}}class r{static calculateCanvasSize(t){const e=r.BLOCK_SIZE*r.BLOCK_AREA_SIZE;return{width:e*t.widthInBlockAreas,height:e*t.heightInBlockAreas}}}r.BLOCK_SIZE=40,r.BLOCK_AREA_SIZE=3,r.FPS=60,r.GAME_SPEED=1e3/r.FPS,function(t){t[t.Stop=0]="Stop",t[t.Slow=1]="Slow",t[t.Fast=r.BLOCK_SIZE/20]="Fast",t[t.VeryFast=2*t.Fast]="VeryFast"}(i||(i={}));class a{constructor(s,n){this._isInitialed=!1,this._inversedDirection=!1,this._collisionFramesCount=0,this.state={position:{x:0,y:0},speed:{dx:0,dy:0},size:{width:0,height:0},speedAbsValue:i.Slow,direction:t.DOWN,moveType:e.Run,isDie:!1},this._currentFrame=1,this._spriteInfo=s,this.state.size=n,this._polygonInfo=n,this._changeFrameBorder=Math.ceil(r.FPS/s.framesCount/(8/3))}get position(){return this.state.position}get speed(){return this.state.speed}set speed(t){this.state.speed=t}get size(){return this.state.size}get direction(){return this.state.direction}set direction(t){this.state.direction=t}get speedAbsValue(){return this.state.speedAbsValue}set speedAbsValue(t){this.state.speedAbsValue=t}inverseDirection(){this._collisionFramesCount++,this._collisionFramesCount===3*r.FPS&&(this._collisionFramesCount=0),this._inversedDirection||(this._inversedDirection=!0,this.speed.dx=-this.speed.dx,this.speed.dy=-this.speed.dy),this._inversedDirection&&50===this._collisionFramesCount&&(this._inversedDirection=!1)}setDirection(t){this.state.direction=t}draw(e,i){var s;if(!this._isInitialed)throw new Error("GameObject is not initialized");this.state.isDie?this._currentFrame=this._spriteInfo.framesCount:i%this._changeFrameBorder==0&&(this._currentFrame++,this._currentFrame>this._spriteInfo.framesCount&&(this._currentFrame=1)),this.state.position.x+=this.state.speed.dx,this.state.position.y+=this.state.speed.dy,this.state.direction=class{static getCurrentDirection(e,i,s){switch(!0){case e>0:return t.RIGHT;case e<0:return t.LEFT;case i>0:return t.DOWN;case i<0:return t.UP}return s}}.getCurrentDirection(this.state.speed.dx,this.state.speed.dy,this.state.direction),this._polygonInfo.showPolygon&&(e.fillStyle="green",e.fillRect(this.state.position.x,this.state.position.y,this.state.size.width,this.state.size.height)),this._polygonInfo.showSprite&&e.drawImage(this._spriteSource,this._spriteInfo.spriteBeginHorizontalOffset+this._spriteInfo.frameOffset*this._currentFrame,this._spriteInfo.spriteBeginVerticalOffset+(this._spriteInfo.verticalOffsets&&(null===(s=this._spriteInfo.verticalOffsets[this.state.direction])||void 0===s?void 0:s[this.state.moveType])||0),this._spriteInfo.spriteWidthInImage,this._spriteInfo.spriteHeightInImage,this.state.position.x-this._polygonInfo.horizontalOffset,this.state.position.y-this._polygonInfo.verticalOffset,this._spriteInfo.spriteWidth,this._spriteInfo.spriteHeight)}init(t,e,i,s){return o=this,r=void 0,h=function*(){try{this.dieEmit=e,this.shootEmit=i,this.state.position=t,this._spriteSource=s||(yield n.load(this._spriteInfo.imageUrl)),this._isInitialed=!0}catch(t){throw new Error("Init GameObject error")}},new((a=void 0)||(a=Promise))((function(t,e){function i(t){try{n(h.next(t))}catch(t){e(t)}}function s(t){try{n(h.throw(t))}catch(t){e(t)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(i,s)}n((h=h.apply(o,r||[])).next())}));var o,r,a,h}}class h extends a{constructor(t,e,s,n,o){super(t,e),this._fireballSpeed=i.VeryFast,this.killers=[],this.direction=n,this.projectileType=s,this._spriteFireballSource=o}kill(){}registerKiller(t){}die(){this.dieEmit(this)}init(t,e,i){const s=Object.create(null,{init:{get:()=>super.init}});return n=this,r=void 0,h=function*(){this.speed=o.getSpeedByDirection(this.direction,this._fireballSpeed),t.x-=this.state.size.width/2,yield s.init.call(this,t,e,i,this._spriteFireballSource)},new((a=void 0)||(a=Promise))((function(t,e){function i(t){try{o(h.next(t))}catch(t){e(t)}}function s(t){try{o(h.throw(t))}catch(t){e(t)}}function o(e){var n;e.done?t(e.value):(n=e.value,n instanceof a?n:new a((function(t){t(n)}))).then(i,s)}o((h=h.apply(n,r||[])).next())}));var n,r,a,h}}var c;class l{constructor(t,e){this.projectileSpriteInfo=t,this.projectilePolygonInfo=e}createProjectile(t,e){return new h(this.projectileSpriteInfo,this.projectilePolygonInfo,t,e,this._spriteSoure)}init(){return t=this,e=void 0,s=function*(){this._spriteSoure=yield n.load(this.projectileSpriteInfo.imageUrl)},new((i=void 0)||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class d{static handleBetweenPlayerAndMap(t,e){!d._canMobMoveDown(t,e)&&t.speed.dy>0&&(t.position.y-=t.speed.dy),!d._canMobMoveUp(t,e)&&t.speed.dy<0&&(t.position.y-=t.speed.dy),!d._canMobMoveRight(t,e)&&t.speed.dx>0&&(t.position.x-=t.speed.dx),!d._canMobMoveLeft(t,e)&&t.speed.dx<0&&(t.position.x-=t.speed.dx)}static handleBetweenMobsAndMap(t,e){t.forEach((t=>{if(d._detectBetwenObjectAndMap(t,e)){t.speed.dx=0,t.speed.dy=0;const e=o.getRandomDirection();t.direction=e;const i=o.getSpeedByDirection(e,t.speedAbsValue);t.speed.dy=i.dy,t.speed.dx=i.dx}}))}static handleBetweenMobs(t){t.forEach((e=>{t.filter((t=>e!==t)).forEach((t=>{d._detectBetweenGameObjects(e,t)&&(e.inverseDirection(),t.inverseDirection())}))}))}static handleBetweenProjectilesAndMap(t,e){t.forEach((t=>{d._detectBetwenObjectAndMap(t,e)&&t.die()}))}static handlePlayerKillers(t){t.killers.forEach((e=>{this._detectBetweenGameObjects(t,e)&&t.die()}))}static handleMobsKillers(t){t.forEach((t=>{t.killers.forEach((e=>{this._detectBetweenGameObjects(e,t)&&(t.die(),e.dieEmit(e))}))}))}static handleBetweenPlayerAndBonuses(t,e){e.forEach((e=>{d._detectBetweenGameObjects(t,e)&&e.remove()}))}static _detectBetwenObjectAndMap(e,i){return e.direction===t.UP&&!d._canMobMoveUp(e,i)||e.direction===t.LEFT&&!d._canMobMoveLeft(e,i)||e.direction===t.RIGHT&&!d._canMobMoveRight(e,i)||e.direction===t.DOWN&&!d._canMobMoveDown(e,i)}static _detectBetweenGameObjects(t,e){return t.position.x<e.position.x+e.size.width&&t.position.x+t.size.width>e.position.x&&t.position.y<e.position.y+e.size.height&&t.position.y+t.size.height>e.position.y}static _canMobMoveUp(t,e){if(t.position.y<=0&&t.speed.dy<0)return!1;const i=Math.max(t.position.x,0),s=Math.max(t.position.y-d._mobCanMoveOffset,0),n=t.position.x+t.size.width-d._mobCanMoveOffset,o=t.position.y-d._mobCanMoveOffset,a=Math.floor(i/r.BLOCK_SIZE),h=Math.floor(s/r.BLOCK_SIZE),c=Math.min(Math.floor(n/r.BLOCK_SIZE),e.mapSize.widthInBlocks-1),l=Math.floor(o/r.BLOCK_SIZE),p=!e.map[a][h],f=!e.map[c][l];return p&&f}static _canMobMoveRight(t,e){const i=e.mapSize.widthInBlocks*r.BLOCK_SIZE;if(t.position.x+t.size.width>=i&&t.speed.dx>0)return!1;const s=t.position.x+t.size.width,n=t.position.y,o=t.position.x+t.size.width,a=t.position.y+t.size.height-d._mobCanMoveOffset,h=Math.min(Math.floor(s/r.BLOCK_SIZE),e.mapSize.widthInBlocks-1),c=Math.min(Math.floor(n/r.BLOCK_SIZE),e.mapSize.heightInBlocks-1),l=Math.min(Math.floor(o/r.BLOCK_SIZE),e.mapSize.widthInBlocks-1),p=Math.min(Math.floor(a/r.BLOCK_SIZE),e.mapSize.heightInBlocks-1),f=!e.map[h][c],_=!e.map[l][p];return f&&_}static _canMobMoveDown(t,e){const i=e.mapSize.heightInBlocks*r.BLOCK_SIZE;if(t.position.y+t.size.height>=i&&t.speed.dy>0)return!1;const s=Math.max(t.position.x,0),n=t.position.y+t.size.height,o=t.position.x+t.size.width-d._mobCanMoveOffset,a=t.position.y+t.size.height,h=Math.max(Math.floor(s/r.BLOCK_SIZE),0),c=Math.max(Math.floor(n/r.BLOCK_SIZE),0),l=Math.min(Math.floor(o/r.BLOCK_SIZE),e.mapSize.widthInBlocks-1),p=Math.min(Math.floor(a/r.BLOCK_SIZE),e.mapSize.heightInBlocks-1),f=!e.map[h][c],_=!e.map[l][p];return f&&_}static _canMobMoveLeft(t,e){if(t.position.x<=0&&t.speed.dx<0)return!1;const i=Math.max(t.position.x-d._mobCanMoveOffset,0),s=Math.max(t.position.y,0),n=Math.max(t.position.x-d._mobCanMoveOffset,0),o=t.position.y+t.size.height-d._mobCanMoveOffset,a=Math.floor(i/r.BLOCK_SIZE),h=Math.floor(s/r.BLOCK_SIZE),c=Math.floor(n/r.BLOCK_SIZE),l=Math.floor(o/r.BLOCK_SIZE),p=!e.map[a][h],f=!e.map[c][l];return p&&f}}d._mobCanMoveOffset=1;class p{constructor(t,e,i,s,n){this._mobs=[],this._mapInfo=t,this._player=e,this._projectiles=s,this._mobs=i,this._bonuses=n}handle(){d.handleBetweenMobs(this._mobs),d.handleBetweenPlayerAndMap(this._player,this._mapInfo),d.handleBetweenMobsAndMap(this._mobs,this._mapInfo),d.handlePlayerKillers(this._player),d.handleMobsKillers(this._mobs),d.handleBetweenProjectilesAndMap(this._projectiles,this._mapInfo),d.handleBetweenPlayerAndBonuses(this._player,this._bonuses)}}!function(t){t[t.KillEnemy=0]="KillEnemy",t[t.KillPlayer=1]="KillPlayer"}(c||(c={}));var f=function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))};class _{constructor(t,e){this._$context=null,this._isInitialized=!1,this.gameObservers=[],this._enemies=[],this._bonues=[],this._projectiles=[],this._isStarted=!1;const i=document.getElementById(t);if(this._gameConfig=e,this._PLAYER=this._gameConfig.player,!(i&&i instanceof HTMLCanvasElement))throw new Error("canvasElementId must be id of HTMLCanvasElement");this._$canvas=i}get mapInfo(){return this._mapInfo}_dieMobEmit(t){this.gameObservers=this.gameObservers.filter((e=>e!==t));const e=this._enemies.indexOf(t);-1!==e&&this._enemies.splice(e,1),this._PLAYER.killers=this._PLAYER.killers.filter((e=>e!==t))}_diePlayerEmit(t){this._PLAYER.killers=[]}_dieBonusEmit(t){this.gameObservers=this.gameObservers.filter((e=>e!==t));const e=this._bonues.indexOf(t);-1!==e&&this._bonues.splice(e,1)}_dieProjectileEmit(t){const e=this._projectiles.indexOf(t);switch(-1!==e&&this._projectiles.splice(e,1),t.projectileType){case c.KillEnemy:this._enemies.forEach((e=>{e.killers=e.killers.filter((e=>e!==t))}));case c.KillPlayer:this._PLAYER.killers=this._PLAYER.killers.filter((e=>e!==t))}this.gameObservers=this.gameObservers.filter((e=>e!==t))}_shootEmit(t,e){return f(this,void 0,void 0,(function*(){this._projectiles.push(t),yield this.registerProjectile(t,e)}))}_registerGameMap(t){return f(this,void 0,void 0,(function*(){this._mapInfo=yield t.init(this._gameConfig),this.gameObservers.push(t)}))}registerProjectile(t,e){return f(this,void 0,void 0,(function*(){this._enemies.forEach((e=>e.registerKiller(t))),yield this.registerGameObserver(t,e,this._dieProjectileEmit,this._shootEmit)}))}registerGameObserver(t,e,i,s){return f(this,void 0,void 0,(function*(){this.gameObservers.push(t),yield t.init(e,i.bind(this),s.bind(this))}))}init(){return f(this,void 0,void 0,(function*(){const t=r.calculateCanvasSize(this._gameConfig);if(this._$canvas.height=t.height,this._$canvas.width=t.width,this._$context=this._$canvas.getContext("2d"),!this._$context)throw new Error("Failed to get canvas context in Game init");yield this._registerGameMap(this._gameConfig.map),yield this.registerGameObserver(this._PLAYER,this._mapInfo.startMapPosition,this._diePlayerEmit,this._shootEmit);for(let t=0;t<this._mapInfo.emptyPlaces.length;t++){const e=this._gameConfig.bonusCreator.createBonus();this._bonues.push(e);const i=this._gameConfig.enemyCreator.createEnemy();this._enemies.push(i),yield this.registerGameObserver(e,Object.assign({},this.mapInfo.emptyPlaces[t]),this._dieBonusEmit,this._shootEmit),yield this.registerGameObserver(i,Object.assign({},this.mapInfo.emptyPlaces[t]),this._dieMobEmit,this._shootEmit),this._PLAYER.registerKiller(i)}this._collisionHandler=new p(this._mapInfo,this._PLAYER,this._enemies,this._projectiles,this._bonues),this._isInitialized=!0}))}drawGameObservers(t){if(!this._$context)throw new Error("Invalid canvas context in Game drawGameObservers()");if(!this._isInitialized)throw new Error("Game is not initalized");this.gameObservers.forEach((e=>{this._collisionHandler.handle(),e.draw(this._$context,t)}))}start(){let t=1;if(this._isStarted)throw new Error("Game has already started");this._isStarted=!0,this._gameInterval=setInterval((()=>{this.drawGameObservers(t),t++,t=t>r.FPS?1:t}),r.GAME_SPEED)}stop(){if(!this._isStarted)throw new Error("Game is not started");this._isStarted=!1,clearInterval(this._gameInterval)}reloadLevel(){this._enemies.length=0,this._projectiles.length=0,this._bonues.length=0,this._PLAYER.killers=[],this._mapInfo=this._gameConfig.map.reload(),this.gameObservers=[this._gameConfig.map,this._PLAYER]}}class u{static generateMap(t){const e=[];u._initMap(e,t);const i=u._getRandomBeginBlock(t);e[i.x][i.y]=!1,u._generateDfs(i,e,t);const s=u._additionalGenerate(e,t),n=u._getEmptyPlaces(t,s);return{map:e,startMapPosition:{x:i.x*r.BLOCK_SIZE,y:i.y*r.BLOCK_SIZE},endMapPosition:i,mapSize:t,emptyPlaces:n}}static _generateDfs(t,e,i){for(const s of u._getAdjacentVertices(t,i))u._isVisitedBlock(s,e)||(u._connectBlocks(t,s,e),u._generateDfs(s,e,i))}static _initMap(t,e){for(let i=0;i<e.widthInBlocks;i++){t[i]=[];for(let s=0;s<e.heightInBlocks;s++)t[i][s]=!0}}static _getRandomBeginBlock(t){const e=t.widthInBlocks/r.BLOCK_AREA_SIZE;let i=o.getRandomInt(0,e);return{x:i>0?i*r.BLOCK_AREA_SIZE-u.BLOCKS_FROM_BORDER_TO_CENTER:u.BLOCKS_FROM_BORDER_TO_CENTER,y:u.BLOCKS_FROM_BORDER_TO_CENTER}}static _getAdjacentVertices(t,e){const i=[],s=e.widthInBlocks-1,n=e.heightInBlocks-1,r=t=>t.x>=0&&t.y>=0&&t.x<=s&&t.y<=n,a={x:t.x,y:t.y-2*u.BLOCKS_FROM_BORDER_TO_CENTER},h={x:t.x+2*u.BLOCKS_FROM_BORDER_TO_CENTER,y:t.y},c={x:t.x,y:t.y+2*u.BLOCKS_FROM_BORDER_TO_CENTER},l={x:t.x-2*u.BLOCKS_FROM_BORDER_TO_CENTER,y:t.y};return r(a)&&i.push(a),r(h)&&i.push(h),r(c)&&i.push(c),r(l)&&i.push(l),i.sort(o.randomSort)}static _isVisitedBlock(t,e){return!e[t.x][t.y]}static _connectBlocks(t,e,i){switch(i[e.x][e.y]=!1,!0){case t.x===e.x:{const s=t.x=e.x;if(t.y>e.y)for(let n=1;n<=u.BLOCKS_FROM_BORDER_TO_CENTER;n++)i[s][t.y-n]=!1,i[s][e.y+n]=!1;else for(let n=1;n<=u.BLOCKS_FROM_BORDER_TO_CENTER;n++)i[s][t.y+n]=!1,i[s][e.y-n]=!1;break}case t.y===e.y:{const s=t.y=e.y;if(t.x>e.x)for(let n=1;n<=u.BLOCKS_FROM_BORDER_TO_CENTER;n++)i[t.x-n][s]=!1,i[e.x+n][s]=!1;else for(let n=1;n<=u.BLOCKS_FROM_BORDER_TO_CENTER;n++)i[t.x+n][s]=!1,i[e.x-n][s]=!1;break}}}static _additionalGenerate(t,e){const i=[],s=Math.ceil(r.BLOCK_AREA_SIZE/2);for(let n=0;n<e.widthInBlocks;n++)for(let r=0;r<e.heightInBlocks;r++)r>=s&&!1===t[n][r]&&i.push({i:n,j:r}),o.getRandomBoolean(u.ADDITIONAL_GENERATE_REMOVE_WALL_CHANCE)&&!u._isVisitedBlock({x:n,y:r},t)&&(t[n][r]=!1);return i}static _getEmptyPlaces(t,e){const i=Math.floor(t.heightInBlocks*t.widthInBlocks/(4*Math.pow(r.BLOCK_AREA_SIZE,2)))||1,s=Math.min(i,e.length),n=[];let a=JSON.parse(JSON.stringify(e));for(let t=0;t<s;t++){let t=o.getRandomInt(0,a.length);const e=a[t];n.push({x:e.i*r.BLOCK_SIZE,y:e.j*r.BLOCK_SIZE}),a=a.filter(((e,i)=>i!==t))}return n}}u.BLOCKS_FROM_BORDER_TO_CENTER=Math.floor(r.BLOCK_AREA_SIZE/2),u.ADDITIONAL_GENERATE_REMOVE_WALL_CHANCE=.35;var m,y,g;!function(t){t[t.DownWall=0]="DownWall",t[t.UpWall=1]="UpWall",t[t.UpDownWall=2]="UpDownWall",t[t.UpDownWallWithWalls=3]="UpDownWallWithWalls",t[t.Area=4]="Area"}(m||(m={}));class v{constructor(t,e){this._areaTextureUrl="",this._wallTextureUrl="",this._mapInfo={map:[],startMapPosition:{x:0,y:0},endMapPosition:{x:20,y:20},mapSize:{heightInBlocks:0,widthInBlocks:0},emptyPlaces:[]},this._areaTextureUrl=t,this._wallTextureUrl=e}get map(){return this._mapInfo.map.map((t=>t.map((t=>t))))}reload(){return this._mapInfo=u.generateMap(this._mapInfo.mapSize),this._mapInfo}init(t){return e=this,i=void 0,o=function*(){try{return this._mapInfo.mapSize.heightInBlocks=t.heightInBlockAreas*r.BLOCK_AREA_SIZE,this._mapInfo.mapSize.widthInBlocks=t.widthInBlockAreas*r.BLOCK_AREA_SIZE,this._mapInfo=u.generateMap(this._mapInfo.mapSize),this._areaTexture=yield n.load(this._areaTextureUrl),this._wallTexture=yield n.load(this._wallTextureUrl),this._mapInfo}catch(t){throw new Error("Map initialize error")}},new((s=void 0)||(s=Promise))((function(t,n){function r(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(r,a)}h((o=o.apply(e,i||[])).next())}));var e,i,s,o}draw(t){if(!this._mapInfo.mapSize)throw new Error("Map is not initialized");for(let e=0;e<this._mapInfo.mapSize.widthInBlocks;e++)for(let i=0;i<this._mapInfo.mapSize.heightInBlocks;i++)t.drawImage(this._areaTexture,r.BLOCK_SIZE*e,r.BLOCK_SIZE*i),!0===this.map[e][i]&&t.drawImage(this._wallTexture,r.BLOCK_SIZE*e,r.BLOCK_SIZE*i)}}!function(t){t.Keydown="keydown",t.Keyup="keyup"}(y||(y={})),function(t){t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Down="ArrowDown",t.Space=" "}(g||(g={}));class O extends a{constructor(t,e){super(t,e),this._eventListeners=[],this.killers=[],this.isShooting=!1,this._controls=[]}registerKiller(t){this.killers.push(t)}die(){this.state.isDie=!0,this.speed.dx=0,this.speed.dy=0,this.destroy(),this.dieEmit(this)}init(t,e,i){const s=Object.create(null,{init:{get:()=>super.init}});return n=this,o=void 0,a=function*(){this._initPlayerControl(),yield s.init.call(this,t,e,i)},new((r=void 0)||(r=Promise))((function(t,e){function i(t){try{h(a.next(t))}catch(t){e(t)}}function s(t){try{h(a.throw(t))}catch(t){e(t)}}function h(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(t){t(n)}))).then(i,s)}h((a=a.apply(n,o||[])).next())}));var n,o,r,a}draw(t,i){this.isShooting?this.state.moveType=e.Shoot:this.state.isDie?this.state.moveType=e.Die:this.state.moveType=0!==this.state.speed.dx||0!==this.state.speed.dy?e.Run:e.Stand,super.draw(t,i)}_initPlayerControl(){this._controls.forEach((t=>{this._registerControlListener(t)}))}_registerControlListener(t){const e=e=>{e.key===t.keyboardKey&&t.handler()};document.addEventListener(y.Keydown,e),this._eventListeners.push({eventType:y.Keydown,eventListener:e})}registerControls(t){t.forEach((t=>{this._registerControlListener(t)}))}destroy(){this._eventListeners.forEach((t=>{document.removeEventListener(t.eventType,t.eventListener)}))}}var w=function(t,e,i,s){return new(i||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))};class E extends O{constructor(t,e,s){super(t,e),this._heroSpeed=i.Fast,this._projectileCreator=s}init(t,e,i){const s=Object.create(null,{init:{get:()=>super.init}});return w(this,void 0,void 0,(function*(){this.registerControls([{keyboardKey:g.Up,handler:this.goUp.bind(this)},{keyboardKey:g.Right,handler:this.goRight.bind(this)},{keyboardKey:g.Down,handler:this.goDown.bind(this)},{keyboardKey:g.Left,handler:this.goLeft.bind(this)},{keyboardKey:g.Space,handler:this.shoot.bind(this)}]),yield s.init.call(this,t,e,i)}))}goUp(){this.state.speed.dy=-this._heroSpeed,this._listenStopDirection(g.Up,t.UP)}goRight(){this.state.speed.dx=this._heroSpeed,this._listenStopDirection(g.Right,t.RIGHT)}goDown(){this.state.speed.dy=this._heroSpeed,this._listenStopDirection(g.Down,t.DOWN)}goLeft(){this.state.speed.dx=-this._heroSpeed,this._listenStopDirection(g.Left,t.LEFT)}shoot(){return w(this,void 0,void 0,(function*(){this.isShooting=!0,setTimeout((()=>w(this,void 0,void 0,(function*(){yield this.shootEmit(this._projectileCreator.createProjectile(c.KillEnemy,this.state.direction),{x:this.state.position.x+this.state.size.width/2,y:this.state.position.y})}))),200),setTimeout((()=>{this.isShooting=!1}),300)}))}_listenStopDirection(e,i){const s=n=>{n.key===e&&(i===t.LEFT||i===t.RIGHT?this.state.speed.dx=0:this.state.speed.dy=0,document.removeEventListener(y.Keyup,s))};document.addEventListener(y.Keyup,s)}}class I extends a{constructor(t,e,s){super(t,e),this._orkSpeed=i.Slow,this.killers=[],this._spriteOrkSource=s}kill(t){t.die()}die(){this.dieEmit(this)}registerKiller(t){this.killers.push(t)}init(t,i,s){const n=Object.create(null,{init:{get:()=>super.init}});return r=this,a=void 0,c=function*(){yield n.init.call(this,t,i,s,this._spriteOrkSource),this.state.moveType=e.Run,this.state.direction=o.getRandomDirection(),this.state.speedAbsValue=this._orkSpeed,this.state.speed=o.getSpeedByDirection(this.state.direction,this._orkSpeed)},new((h=void 0)||(h=Promise))((function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function s(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof h?n:new h((function(t){t(n)}))).then(i,s)}n((c=c.apply(r,a||[])).next())}));var r,a,h,c}}class S{constructor(t,e){this.enemySpriteInfo=t,this.enemyPolygonInfo=e}createEnemy(){return new I(this.enemySpriteInfo,this.enemyPolygonInfo,this._spriteSource)}init(){return t=this,e=void 0,s=function*(){this._spriteSource=yield n.load(this.enemySpriteInfo.imageUrl)},new((i=void 0)||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}}class B extends a{constructor(t,e,s){super(t,e),this._coinSpeed=i.Stop,this._spriteCoinSource=s}remove(){this.dieEmit(this)}init(e,i,s){const n=Object.create(null,{init:{get:()=>super.init}});return r=this,a=void 0,c=function*(){yield n.init.call(this,e,i,s,this._spriteCoinSource),this.state.speedAbsValue=this._coinSpeed,this.direction=t.DOWN,this.speed=o.getSpeedByDirection(t.DOWN,this._coinSpeed)},new((h=void 0)||(h=Promise))((function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function s(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){var n;e.done?t(e.value):(n=e.value,n instanceof h?n:new h((function(t){t(n)}))).then(i,s)}n((c=c.apply(r,a||[])).next())}));var r,a,h,c}}class b{constructor(t,e){this.bonusSpriteInfo=t,this.bonusPolygonInfo=e}createBonus(){return new B(this.bonusSpriteInfo,this.bonusPolygonInfo,this._spriteSource)}init(){return t=this,e=void 0,s=function*(){this._spriteSource=yield n.load(this.bonusSpriteInfo.imageUrl)},new((i=void 0)||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}));var t,e,i,s}}const x=s.p+"assets/0bdf715bc8e1b6dfe3914e094ec1c517.jpg",R=s.p+"assets/00a1dec6acb20dbb72df1909dc1a8bf4.png",M=s.p+"assets/646a24ba70cea92c9b0cc608ad0644b1.png",C=s.p+"assets/2a7beb553dc8def92e0c1623e116a18f.png",L=s.p+"assets/03cae8a53b569d42e8cc4f77282448ae.png",P=s.p+"assets/9eb190360ef49dd43b2ab4783e8a5b22.png",D={imageUrl:M,spriteBeginHorizontalOffset:6,spriteBeginVerticalOffset:0,frameOffset:64,framesCount:5,spriteWidthInImage:50,spriteHeightInImage:60,spriteWidth:34,spriteHeight:40,verticalOffsets:{[t.UP]:{[e.Run]:518,[e.Stand]:772,[e.Shoot]:6,[e.Die]:1300},[t.RIGHT]:{[e.Run]:708,[e.Stand]:966,[e.Shoot]:196,[e.Die]:1300},[t.DOWN]:{[e.Run]:645,[e.Stand]:900,[e.Shoot]:132,[e.Die]:1300},[t.LEFT]:{[e.Run]:580,[e.Stand]:834,[e.Shoot]:70,[e.Die]:1300}}},T={imageUrl:C,frameOffset:64,framesCount:6,spriteBeginHorizontalOffset:8,spriteBeginVerticalOffset:6,spriteWidthInImage:60,spriteHeightInImage:60,spriteWidth:50,spriteHeight:50,verticalOffsets:{[t.UP]:{[e.Run]:522},[t.RIGHT]:{[e.Run]:712},[t.DOWN]:{[e.Run]:650},[t.LEFT]:{[e.Run]:586}}},K={imageUrl:L,frameOffset:40,framesCount:3,spriteBeginHorizontalOffset:0,spriteBeginVerticalOffset:0,spriteHeightInImage:40,spriteWidthInImage:40,spriteHeight:40,spriteWidth:40,verticalOffsets:{[t.RIGHT]:{[e.Run]:0},[t.UP]:{[e.Run]:0},[t.DOWN]:{[e.Run]:0},[t.LEFT]:{[e.Run]:0}}},A={imageUrl:P,frameOffset:40,framesCount:9,spriteBeginHorizontalOffset:0,spriteBeginVerticalOffset:0,spriteHeightInImage:40,spriteWidthInImage:40,spriteHeight:40,spriteWidth:40,verticalOffsets:{[t.RIGHT]:{[e.Run]:0},[t.UP]:{[e.Run]:0},[t.DOWN]:{[e.Run]:0},[t.LEFT]:{[e.Run]:0}}};!function(){var t,e,i,s;t=this,e=void 0,s=function*(){const t=new l(K,{width:13,height:13,verticalOffset:14,horizontalOffset:13,showPolygon:!1,showSprite:!0});yield t.init();const e=new S(T,{width:30,height:40,verticalOffset:0,horizontalOffset:5,showSprite:!0,showPolygon:!1});yield e.init();const i=new b(A,{width:40,height:40,horizontalOffset:0,verticalOffset:0,showPolygon:!1,showSprite:!0});yield i.init();const s=new _("canvas",{widthInBlockAreas:o.getRandomInt(1,12),heightInBlockAreas:o.getRandomInt(1,5),map:new v(x,R),player:new E(D,{height:22,width:16,verticalOffset:14,horizontalOffset:10,showPolygon:!1,showSprite:!0},t),enemyCreator:e,bonusCreator:i});yield s.init(),s.start()},new((i=void 0)||(i=Promise))((function(n,o){function r(t){try{h(s.next(t))}catch(t){o(t)}}function a(t){try{h(s.throw(t))}catch(t){o(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((s=s.apply(t,e||[])).next())}))}()})();